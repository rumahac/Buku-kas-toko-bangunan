# ===== KEAMANAN SISTEM KAS SETIA JAYA =====
Options -Indexes
Options -MultiViews
RewriteEngine On

# ===== PROTECT SENSITIVE FILES =====
<FilesMatch "\.(env|ini|log|sh|sql|bak|config|dist|htaccess|htpasswd|gitignore|DS_Store|sqlite|db)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# ===== BLOCK ACCESS TO HIDDEN FILES =====
RedirectMatch 404 /\..*$

# ===== PROTECT UPLOADS FOLDER =====
<Directory "uploads/">
    Options -Indexes
    <FilesMatch "\.(php|pl|py|jsp|asp|htm|shtml|sh|cgi|php5|php7|phtml)$">
        Order Deny,Allow
        Deny from all
    </FilesMatch>
</Directory>

# ===== PREVENT DIRECT ACCESS TO PHP FILES =====
RewriteCond %{REQUEST_FILENAME} -f
RewriteCond %{REQUEST_FILENAME} \.php$
RewriteCond %{REQUEST_URI} !^/(index|login|register|api|predictions|users|log|logout)\.php
RewriteRule ^ - [F,L]

# ===== FORCE HTTPS (Uncomment jika pakai SSL) =====
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

# ===== SECURITY HEADERS =====
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
    Header set Permissions-Policy "geolocation=(), microphone=(), camera=()"
    
    # Content Security Policy (CSP) - Sesuaikan dengan kebutuhan
</IfModule>

# ===== KOMPRESI GZIP =====
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# ===== CACHE CONTROL =====
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
</IfModule>

# ===== ERROR PAGES =====
ErrorDocument 403 /error.php?code=403
ErrorDocument 404 /error.php?code=404
ErrorDocument 500 /error.php?code=500